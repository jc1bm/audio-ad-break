<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Ad-In-Situ Maker</title>
</head>
<body>

  <h1>Audio Ad Break</h1>

  <!-- Your select inputs remain unchanged -->
  <select id="station_in">
    <option value="audio/station/absolute.wav">Absolute</option>
    <option value="audio/station/sting2.wav">Sting 2</option>
    <option value="audio/ad/none.wav">None</option>
  </select>

  <!-- Other select elements here (ad1, gap1, ad2, gap2, etc.) -->

  <select id="station_out">
    <option value="audio/station/absolute.wav">Absolute</option>
    <option value="audio/station/sting2.wav">Sting 2</option>
    <option value="audio/ad/none.wav">None</option>
  </select>

  <button onclick="createAdBreak()">Generate Ad Break</button>

  <!-- Your main script -->
  <script src="script.js" defer></script>

  <!-- Dynamic file format detection -->
  <script>
    async function resolveTargetFormat() {
      const basePath = 'audio/ad/target';
      const formats = ['.wav', '.mp3'];
      let found = false;

      for (const ext of formats) {
        const url = basePath + ext;
        try {
          const res = await fetch(url, { method: 'HEAD' });
          if (res.ok) {
            updateTargetOption(ext);
            found = true;
            break;
          }
        } catch (e) {
          console.warn(`Could not load ${url}`);
        }
      }

      if (!found) {
        removeTargetOptions();
      }
    }

    function updateTargetOption(ext) {
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        [...select.options].forEach(option => {
          if (option.value.includes('audio/ad/target')) {
            option.value = `audio/ad/target${ext}`;
          }
        });
      });
    }

    function removeTargetOptions() {
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        [...select.options].forEach((option, i) => {
          if (option.value === 'audio/ad/target.wav' || option.value === 'audio/ad/target.mp3') {
            select.remove(i);
          }
        });
      });
    }

    window.addEventListener('DOMContentLoaded', resolveTargetFormat);
  </script>

  <br /><br />

  <a href="https://github.com/jc1bm/audio-ad-break/tree/main/audio/ad" target="_blank">
    Clear target audio
  </a>

  <br /><br />

  <a href="https://github.com/jc1bm/audio-ad-break/upload/main/audio/ad" target="_blank">
    Upload target audio
  </a>

</body>
</html>
