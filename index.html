<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Ad-In-Situ Maker</title>
</head>
<body>
  <h1>Ad-In-Situ Maker</h1>

  <!-- Station In -->
  <select id="station_in">
    <option value="audio/station/absolute.wav">Absolute</option>
    <option value="audio/station/sting2.wav">Sting 2</option>
    <option value="audio/ad/none.wav">None</option>
  </select>

  <!-- All ad/gap selects -->
  <!-- You can paste your long list of ad/gap selects here exactly as you have it -->

  <!-- Station Out -->
  <br /><br />
  <select id="station_out">
    <option value="audio/station/absolute.wav">Absolute</option>
    <option value="audio/station/sting2.wav">Sting 2</option>
    <option value="audio/ad/none.wav">None</option>
  </select>

  <!-- Export Type -->
  <br /><br />
  <select id="exportType">
    <option value="audio">Audio Only (WAV)</option>
    <option value="video">Video with Image (MP4)</option>
  </select>

  <br /><br />
  <button onclick="createAdBreak()">Generate Ad Break</button>

  <!-- FFmpeg.wasm module loader via ES Module (GitHub Pages friendly) -->
  <script type="module">
    import { createFFmpeg, fetchFile } from 'https://unpkg.com/@ffmpeg/ffmpeg@0.12.2/dist/ffmpeg.min.js';

    window.ffmpeg = createFFmpeg({ log: true });
    window.fetchFile = fetchFile;
  </script>

  <!-- Your main script -->
  <script src="script.js" defer></script>

  <!-- Dynamic format detection for target.mp3/.wav -->
  <script>
    async function resolveTargetFormat() {
      const basePath = 'audio/ad/target';
      const formats = ['.wav', '.mp3'];
      let found = false;

      for (const ext of formats) {
        const url = basePath + ext;
        try {
          const res = await fetch(url, { method: 'HEAD' });
          if (res.ok) {
            updateTargetOption(ext);
            found = true;
            break;
          }
        } catch (e) {
          console.warn(`Could not load ${url}`);
        }
      }

      if (!found) {
        removeTargetOptions();
      }
    }

    function updateTargetOption(ext) {
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        [...select.options].forEach(option => {
          if (option.value.includes('audio/ad/target')) {
            option.value = `audio/ad/target${ext}`;
          }
        });
      });
    }

    function removeTargetOptions() {
      const selects = document.querySelectorAll('select');
      selects.forEach(select => {
        [...select.options].forEach((option, i) => {
          if (option.value.includes('audio/ad/target')) {
            select.remove(i);
          }
        });
      });
    }

    window.addEventListener('DOMContentLoaded', resolveTargetFormat);
  </script>

  <!-- Upload/clear target audio links -->
  <br /><br />
  <a href="https://github.com/jc1bm/audio-ad-break/tree/main/audio/ad" target="_blank">Clear target audio</a>
  <br /><br />
  <a href="https://github.com/jc1bm/audio-ad-break/upload/main/audio/ad" target="_blank">Upload target audio</a>

</body>
</html>
